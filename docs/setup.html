<!DOCTYPE html>  <html> <head>   <title>setup.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="app.html">                 app.js               </a>                                           <a class="source" href="background.html">                 background.js               </a>                                           <a class="source" href="setup.html">                 setup.js               </a>                                           <a class="source" href="google.html">                 google.js               </a>                                           <a class="source" href="article.html">                 article.js               </a>                                           <a class="source" href="displayed-articles.html">                 displayed-articles.js               </a>                                           <a class="source" href="search.html">                 search.js               </a>                                           <a class="source" href="setting.html">                 setting.js               </a>                                           <a class="source" href="setup.html">                 setup.js               </a>                                           <a class="source" href="templates.html">                 templates.js               </a>                                           <a class="source" href="ui.html">                 ui.js               </a>                                           <a class="source" href="article-view.html">                 article-view.js               </a>                                           <a class="source" href="category-view.html">                 category-view.js               </a>                                           <a class="source" href="fullscreen-view.html">                 fullscreen-view.js               </a>                                           <a class="source" href="intent-view.html">                 intent-view.js               </a>                                           <a class="source" href="notifications-view.html">                 notifications-view.js               </a>                                           <a class="source" href="search-results-view.html">                 search-results-view.js               </a>                                           <a class="source" href="search-view.html">                 search-view.js               </a>                                           <a class="source" href="settings-view.html">                 settings-view.js               </a>                                           <a class="source" href="window-view.html">                 window-view.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               setup.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global App: false, Filer: false */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Authors</h3>

<p>Jamie Dyer <a href="http://kernowsoul.com">http://kernowsoul.com</a></p>

<h3>Last changed</h3>

<p>2012-06-23</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>initialize settings</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Create a new settings model</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Settings</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Fetch the settings from the sync storage</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;javascripts/settings.json&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">App</span><span class="p">.</span><span class="nx">defaultCategories</span>   <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">defaultCategories</span><span class="p">;</span>
        <span class="nx">App</span><span class="p">.</span><span class="nx">supportedLanguages</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">languages</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If no categories have been previously stored set the default categories</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;categories&#39;</span><span class="p">)){</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Save the categories in the settings model</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span> <span class="s2">&quot;categories&quot;</span> <span class="o">:</span> <span class="nx">App</span><span class="p">.</span><span class="nx">defaultCategories</span> <span class="p">});</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If not feed language has been set create one</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;feedLanguage&#39;</span><span class="p">)){</span>
          <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
            <span class="s2">&quot;feedLanguage&quot;</span> <span class="o">:</span> <span class="p">{</span>
              <span class="s2">&quot;code&quot;</span><span class="o">:</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">i18n</span><span class="p">.</span><span class="nx">getMessage</span><span class="p">(</span><span class="s2">&quot;languageCode&quot;</span><span class="p">),</span>
              <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">i18n</span><span class="p">.</span><span class="nx">getMessage</span><span class="p">(</span><span class="s2">&quot;nation&quot;</span><span class="p">)</span>
          <span class="p">}});</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Settings have been fetched so we can initialize the articles and settings view</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">App</span><span class="p">.</span><span class="nx">initializeArticles</span><span class="p">();</span>
        <span class="nx">App</span><span class="p">.</span><span class="nx">initializeSettingsView</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Initialize categories list</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">CategoriesListView</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>send a message to the background process to stop working every 60 seconds
currently there is no event for when the app window is closed so we get the main app to send a message to
the background process every 60 seconds telling it to stay paused. There should be an onSuspend event at
some point which can be used instead of this code</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="s1">&#39;pause&#39;</span><span class="p">);</span>
  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="s1">&#39;pause&#39;</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">60000</span><span class="p">);</span>

  <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="s1">&#39;appOpened&#39;</span><span class="p">);</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This setting is used to control the packground processing of feeds</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">App</span><span class="p">.</span><span class="nx">canBackgroundProcess</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">initializeSettingsView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">SettingsView</span><span class="p">();</span> <span class="p">};</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">initialize_window_view</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">WindowView</span><span class="p">();</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Restore the state of the application on load, settings are loaded from the</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">App</span><span class="p">.</span><span class="nx">restoreState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Restore the state of an open article if needed</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">articleId</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;openArticleId&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">articleId</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Load the article from storage</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">article</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">articles</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">articleId</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">article</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If the article is found restore the viewing state using the article view</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">articleView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">ArticleView</span><span class="p">({</span> <span class="nx">model</span><span class="o">:</span> <span class="nx">article</span> <span class="p">});</span>
      <span class="nx">articleView</span><span class="p">.</span><span class="nx">openLink</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>If the article can't be found remove the setting from storeage</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">App</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">saveOpenArticleId</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">initializeArticles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>initialize filer</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">App</span><span class="p">.</span><span class="nx">filer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Filer</span><span class="p">();</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">filer</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="nx">persistent</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">size</span><span class="o">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">filer</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">10485760</span><span class="p">;</span> <span class="c1">// set the file size limit to 10 mb</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The Articles collection keeps track of all known articles</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">App</span><span class="p">.</span><span class="nx">articles</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Articles</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>The DisplayedArticles collection stores only the articles displayed on the screen</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">App</span><span class="p">.</span><span class="nx">displayedArticles</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayedArticles</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Initialize the articles view and pass it the DisplayedArticles collection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">App</span><span class="p">.</span><span class="nx">articles_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">ArticlesView</span><span class="p">({</span> <span class="nx">collection</span><span class="o">:</span> <span class="nx">App</span><span class="p">.</span><span class="nx">displayedArticles</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Fetch articles to display</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">App</span><span class="p">.</span><span class="nx">displayedArticles</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>

    <span class="nx">App</span><span class="p">.</span><span class="nx">articles</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Load new articles from the feed on initialisation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">App</span><span class="p">.</span><span class="nx">articles</span><span class="p">.</span><span class="nx">getFromFeed</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">googleFeed</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Load new articles every minute</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">App</span><span class="p">.</span><span class="nx">articles</span><span class="p">.</span><span class="nx">getFromFeed</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">googleFeed</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">60000</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Search initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">App</span><span class="p">.</span><span class="nx">searchResults</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">SearchResults</span><span class="p">();</span>
    <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">SearchResultsView</span><span class="p">({</span> <span class="nx">collection</span><span class="o">:</span> <span class="nx">App</span><span class="p">.</span><span class="nx">searchResults</span> <span class="p">});</span>
    <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">SearchView</span><span class="p">();</span>


  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;error: &#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">CloseBrowserView</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">initialize_window_view</span><span class="p">();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 